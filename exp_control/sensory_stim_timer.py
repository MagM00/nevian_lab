import tkinter as tk
from datetime import timedelta, datetime
 
# Sample data dictionary (Replace this with your actual data)
data = {
    "Set1": {
        "Stim": [
            1,1,1,3,3,3,2,2,2,0,0,0,5,5,5,6,6,6,4,4,4,
            6,6,6,2,2,2,3,3,3,4,4,4,5,5,5,1,1,1,0,0,0,
            4,4,4,1,1,1,2,2,2,5,5,5,3,3,3,6,6,6,0,0,0,
            6,6,6,0,0,0,5,5,5,1,1,1,2,2,2,4,4,4,3,3,3,
            4,4,4,6,6,6,1,1,1,5,5,5,0,0,0,2,2,2,3,3,3
        ],
        "Time": [
    "00:00:30", "00:01:00", "00:01:30",
    "00:02:00", "00:02:30", "00:03:00",
    "00:03:30", "00:04:00", "00:04:30",
    "00:05:00", "00:05:30", "00:06:00",
    "00:06:30", "00:07:00", "00:07:30",
    "00:08:00", "00:08:30", "00:09:00",
    "00:09:30", "00:10:00", "00:10:30",
    "00:11:00", "00:11:30", "00:12:00",
    "00:12:30", "00:13:00", "00:13:30",
    "00:14:00", "00:14:30", "00:15:00",
    "00:15:30", "00:16:00", "00:16:30",
    "00:17:00", "00:17:30", "00:18:00",
    "00:18:30", "00:19:00", "00:19:30",
    "00:20:00", "00:20:30", "00:21:00",
    "00:21:30", "00:22:00", "00:22:30",
    "00:23:00", "00:23:30", "00:24:00",
    "00:24:30", "00:25:00", "00:25:30",
    "00:26:00", "00:26:30", "00:27:00",
    "00:27:30", "00:28:00", "00:28:30",
    "00:29:00", "00:29:30", "00:30:00",
    "00:30:30", "00:31:00", "00:31:30",
    "00:32:00", "00:32:30", "00:33:00",
    "00:33:30", "00:34:00", "00:34:30",
    "00:35:00", "00:35:30", "00:36:00",
    "00:36:30", "00:37:00", "00:37:30",
    "00:38:00", "00:38:30", "00:39:00",
    "00:39:30", "00:40:00", "00:40:30",
    "00:41:00", "00:41:30", "00:42:00",
    "00:42:30", "00:43:00", "00:43:30",
    "00:44:00", "00:44:30", "00:45:00",
    "00:45:30", "00:46:00", "00:46:30",
    "00:47:00", "00:47:30", "00:48:00",
    "00:48:30", "00:49:00", "00:49:30",
    "00:50:00", "00:50:30", "00:51:00",
    "00:51:30", "00:52:00", "00:52:30",
        ]
    },
    "Set2": {
        "Stim": [
            1,1,1,4,4,4,5,5,5,3,3,3,6,6,6,2,2,2,0,0,0,
            2,2,2,5,5,5,4,4,4,3,3,3,1,1,1,6,6,6,0,0,0,
            3,3,3,5,5,5,6,6,6,4,4,4,0,0,0,1,1,1,2,2,2,
            4,4,4,2,2,2,6,6,6,3,3,3,0,0,0,5,5,5,1,1,1,
            6,6,6,2,2,2,0,0,0,4,4,4,1,1,1,3,3,3,5,5,5,
            4,4,4,3,3,3,0,0,0,5,5,5,2,2,2,1,1,1,6,6,6
        ],
        "Time": [
    "00:00:30", "00:01:00", "00:01:30",
    "00:02:00", "00:02:30", "00:03:00",
    "00:03:30", "00:04:00", "00:04:30",
    "00:05:00", "00:05:30", "00:06:00",
    "00:06:30", "00:07:00", "00:07:30",
    "00:08:00", "00:08:30", "00:09:00",
    "00:09:30", "00:10:00", "00:10:30",
    "00:11:00", "00:11:30", "00:12:00",
    "00:12:30", "00:13:00", "00:13:30",
    "00:14:00", "00:14:30", "00:15:00",
    "00:15:30", "00:16:00", "00:16:30",
    "00:17:00", "00:17:30", "00:18:00",
    "00:18:30", "00:19:00", "00:19:30",
    "00:20:00", "00:20:30", "00:21:00",
    "00:21:30", "00:22:00", "00:22:30",
    "00:23:00", "00:23:30", "00:24:00",
    "00:24:30", "00:25:00", "00:25:30",
    "00:26:00", "00:26:30", "00:27:00",
    "00:27:30", "00:28:00", "00:28:30",
    "00:29:00", "00:29:30", "00:30:00",
    "00:30:30", "00:31:00", "00:31:30",
    "00:32:00", "00:32:30", "00:33:00",
    "00:33:30", "00:34:00", "00:34:30",
    "00:35:00", "00:35:30", "00:36:00",
    "00:36:30", "00:37:00", "00:37:30",
    "00:38:00", "00:38:30", "00:39:00",
    "00:39:30", "00:40:00", "00:40:30",
    "00:41:00", "00:41:30", "00:42:00",
    "00:42:30", "00:43:00", "00:43:30",
    "00:44:00", "00:44:30", "00:45:00",
    "00:45:30", "00:46:00", "00:46:30",
    "00:47:00", "00:47:30", "00:48:00",
    "00:48:30", "00:49:00", "00:49:30",
    "00:50:00", "00:50:30", "00:51:00",
    "00:51:30", "00:52:00", "00:52:30",
    "00:53:00", "00:53:30", "00:54:00",
    "00:54:30", "00:55:00", "00:55:30",
    "00:56:00", "00:56:30", "00:57:00",
    "00:57:30", "00:58:00", "00:58:30",
    "00:59:00", "00:59:30", "01:00:00",
    "01:00:30", "01:01:00", "01:01:30",
    "01:02:00", "01:02:30", "01:03:00",
        ]

    },
        "Set3": {
        "Stim": [
            4,4,4,2,2,2,6,6,6,5,5,5,0,0,0,1,1,1,3,3,3,
            4,4,4,3,3,3,6,6,6,0,0,0,5,5,5,1,1,1,2,2,2,
            2,2,2,4,4,4,5,5,5,1,1,1,0,0,0,3,3,3,6,6,6,
            4,4,4,2,2,2,3,3,3,0,0,0,1,1,1,5,5,5,6,6,6,
            6,6,6,3,3,3,4,4,4,5,5,5,2,2,2,0,0,0,1,1,1,
            2,2,2,5,5,5,6,6,6,3,3,3,1,1,1,4,4,4,0,0,0
        ],
        "Time": [
    "00:00:30", "00:01:00", "00:01:30",
    "00:02:00", "00:02:30", "00:03:00",
    "00:03:30", "00:04:00", "00:04:30",
    "00:05:00", "00:05:30", "00:06:00",
    "00:06:30", "00:07:00", "00:07:30",
    "00:08:00", "00:08:30", "00:09:00",
    "00:09:30", "00:10:00", "00:10:30",
    "00:11:00", "00:11:30", "00:12:00",
    "00:12:30", "00:13:00", "00:13:30",
    "00:14:00", "00:14:30", "00:15:00",
    "00:15:30", "00:16:00", "00:16:30",
    "00:17:00", "00:17:30", "00:18:00",
    "00:18:30", "00:19:00", "00:19:30",
    "00:20:00", "00:20:30", "00:21:00",
    "00:21:30", "00:22:00", "00:22:30",
    "00:23:00", "00:23:30", "00:24:00",
    "00:24:30", "00:25:00", "00:25:30",
    "00:26:00", "00:26:30", "00:27:00",
    "00:27:30", "00:28:00", "00:28:30",
    "00:29:00", "00:29:30", "00:30:00",
    "00:30:30", "00:31:00", "00:31:30",
    "00:32:00", "00:32:30", "00:33:00",
    "00:33:30", "00:34:00", "00:34:30",
    "00:35:00", "00:35:30", "00:36:00",
    "00:36:30", "00:37:00", "00:37:30",
    "00:38:00", "00:38:30", "00:39:00",
    "00:39:30", "00:40:00", "00:40:30",
    "00:41:00", "00:41:30", "00:42:00",
    "00:42:30", "00:43:00", "00:43:30",
    "00:44:00", "00:44:30", "00:45:00",
    "00:45:30", "00:46:00", "00:46:30",
    "00:47:00", "00:47:30", "00:48:00",
    "00:48:30", "00:49:00", "00:49:30",
    "00:50:00", "00:50:30", "00:51:00",
    "00:51:30", "00:52:00", "00:52:30",
    "00:53:00", "00:53:30", "00:54:00",
    "00:54:30", "00:55:00", "00:55:30",
    "00:56:00", "00:56:30", "00:57:00",
    "00:57:30", "00:58:00", "00:58:30",
    "00:59:00", "00:59:30", "01:00:00",
    "01:00:30", "01:01:00", "01:01:30",
    "01:02:00", "01:02:30", "01:03:00",
        ]

    },
        "Set4": {
        "Stim": [
            1,1,1,6,6,6,3,3,3,4,4,4,0,0,0,5,5,5,2,2,2,
            3,3,3,6,6,6,5,5,5,2,2,2,1,1,1,0,0,0,4,4,4,
            1,1,1,5,5,5,2,2,2,3,3,3,4,4,4,0,0,0,6,6,6,
            1,1,1,2,2,2,0,0,0,4,4,4,5,5,5,3,3,3,6,6,6,
            2,2,2,0,0,0,1,1,1,6,6,6,5,5,5,3,3,3,4,4,4,
            1,1,1,0,0,0,4,4,4,6,6,6,2,2,2,3,3,3,5,5,5
        ],
        "Time": [
    "00:00:30", "00:01:00", "00:01:30",
    "00:02:00", "00:02:30", "00:03:00",
    "00:03:30", "00:04:00", "00:04:30",
    "00:05:00", "00:05:30", "00:06:00",
    "00:06:30", "00:07:00", "00:07:30",
    "00:08:00", "00:08:30", "00:09:00",
    "00:09:30", "00:10:00", "00:10:30",
    "00:11:00", "00:11:30", "00:12:00",
    "00:12:30", "00:13:00", "00:13:30",
    "00:14:00", "00:14:30", "00:15:00",
    "00:15:30", "00:16:00", "00:16:30",
    "00:17:00", "00:17:30", "00:18:00",
    "00:18:30", "00:19:00", "00:19:30",
    "00:20:00", "00:20:30", "00:21:00",
    "00:21:30", "00:22:00", "00:22:30",
    "00:23:00", "00:23:30", "00:24:00",
    "00:24:30", "00:25:00", "00:25:30",
    "00:26:00", "00:26:30", "00:27:00",
    "00:27:30", "00:28:00", "00:28:30",
    "00:29:00", "00:29:30", "00:30:00",
    "00:30:30", "00:31:00", "00:31:30",
    "00:32:00", "00:32:30", "00:33:00",
    "00:33:30", "00:34:00", "00:34:30",
    "00:35:00", "00:35:30", "00:36:00",
    "00:36:30", "00:37:00", "00:37:30",
    "00:38:00", "00:38:30", "00:39:00",
    "00:39:30", "00:40:00", "00:40:30",
    "00:41:00", "00:41:30", "00:42:00",
    "00:42:30", "00:43:00", "00:43:30",
    "00:44:00", "00:44:30", "00:45:00",
    "00:45:30", "00:46:00", "00:46:30",
    "00:47:00", "00:47:30", "00:48:00",
    "00:48:30", "00:49:00", "00:49:30",
    "00:50:00", "00:50:30", "00:51:00",
    "00:51:30", "00:52:00", "00:52:30",
    "00:53:00", "00:53:30", "00:54:00",
    "00:54:30", "00:55:00", "00:55:30",
    "00:56:00", "00:56:30", "00:57:00",
    "00:57:30", "00:58:00", "00:58:30",
    "00:59:00", "00:59:30", "01:00:00",
    "01:00:30", "01:01:00", "01:01:30",
    "01:02:00", "01:02:30", "01:03:00",
        ]

    },
        "Set5": {
        "Stim": [
            0,0,0,4,4,4,5,5,5,1,1,1,3,3,3,2,2,2,6,6,6,
            3,3,3,5,5,5,4,4,4,1,1,1,2,2,2,0,0,0,6,6,6,
            6,6,6,4,4,4,5,5,5,0,0,0,3,3,3,1,1,1,2,2,2,
            1,1,1,5,5,5,0,0,0,2,2,2,6,6,6,4,4,4,3,3,3,
            0,0,0,5,5,5,6,6,6,3,3,3,1,1,1,4,4,4,2,2,2,
            5,5,5,6,6,6,1,1,1,2,2,2,4,4,4,0,0,0,3,3,3
        ],
        "Time": [
    "00:00:30", "00:01:00", "00:01:30",
    "00:02:00", "00:02:30", "00:03:00",
    "00:03:30", "00:04:00", "00:04:30",
    "00:05:00", "00:05:30", "00:06:00",
    "00:06:30", "00:07:00", "00:07:30",
    "00:08:00", "00:08:30", "00:09:00",
    "00:09:30", "00:10:00", "00:10:30",
    "00:11:00", "00:11:30", "00:12:00",
    "00:12:30", "00:13:00", "00:13:30",
    "00:14:00", "00:14:30", "00:15:00",
    "00:15:30", "00:16:00", "00:16:30",
    "00:17:00", "00:17:30", "00:18:00",
    "00:18:30", "00:19:00", "00:19:30",
    "00:20:00", "00:20:30", "00:21:00",
    "00:21:30", "00:22:00", "00:22:30",
    "00:23:00", "00:23:30", "00:24:00",
    "00:24:30", "00:25:00", "00:25:30",
    "00:26:00", "00:26:30", "00:27:00",
    "00:27:30", "00:28:00", "00:28:30",
    "00:29:00", "00:29:30", "00:30:00",
    "00:30:30", "00:31:00", "00:31:30",
    "00:32:00", "00:32:30", "00:33:00",
    "00:33:30", "00:34:00", "00:34:30",
    "00:35:00", "00:35:30", "00:36:00",
    "00:36:30", "00:37:00", "00:37:30",
    "00:38:00", "00:38:30", "00:39:00",
    "00:39:30", "00:40:00", "00:40:30",
    "00:41:00", "00:41:30", "00:42:00",
    "00:42:30", "00:43:00", "00:43:30",
    "00:44:00", "00:44:30", "00:45:00",
    "00:45:30", "00:46:00", "00:46:30",
    "00:47:00", "00:47:30", "00:48:00",
    "00:48:30", "00:49:00", "00:49:30",
    "00:50:00", "00:50:30", "00:51:00",
    "00:51:30", "00:52:00", "00:52:30",
    "00:53:00", "00:53:30", "00:54:00",
    "00:54:30", "00:55:00", "00:55:30",
    "00:56:00", "00:56:30", "00:57:00",
    "00:57:30", "00:58:00", "00:58:30",
    "00:59:00", "00:59:30", "01:00:00",
    "01:00:30", "01:01:00", "01:01:30",
    "01:02:00", "01:02:30", "01:03:00",
        ]

    },
        "Set6": {
        "Stim": [
            4,4,4,5,5,5,1,1,1,0,0,0,6,6,6,2,2,2,3,3,3,
            4,4,4,2,2,2,6,6,6,5,5,5,0,0,0,1,1,1,3,3,3,
            5,5,5,4,4,4,1,1,1,6,6,6,3,3,3,2,2,2,0,0,0,
            6,6,6,1,1,1,5,5,5,2,2,2,4,4,4,3,3,3,0,0,0,
            3,3,3,6,6,6,5,5,5,1,1,1,0,0,0,4,4,4,2,2,2,
            5,5,5,0,0,0,4,4,4,6,6,6,2,2,2,1,1,1,3,3,3,
        ],
        "Time": [
    "00:00:30", "00:01:00", "00:01:30",
    "00:02:00", "00:02:30", "00:03:00",
    "00:03:30", "00:04:00", "00:04:30",
    "00:05:00", "00:05:30", "00:06:00",
    "00:06:30", "00:07:00", "00:07:30",
    "00:08:00", "00:08:30", "00:09:00",
    "00:09:30", "00:10:00", "00:10:30",
    "00:11:00", "00:11:30", "00:12:00",
    "00:12:30", "00:13:00", "00:13:30",
    "00:14:00", "00:14:30", "00:15:00",
    "00:15:30", "00:16:00", "00:16:30",
    "00:17:00", "00:17:30", "00:18:00",
    "00:18:30", "00:19:00", "00:19:30",
    "00:20:00", "00:20:30", "00:21:00",
    "00:21:30", "00:22:00", "00:22:30",
    "00:23:00", "00:23:30", "00:24:00",
    "00:24:30", "00:25:00", "00:25:30",
    "00:26:00", "00:26:30", "00:27:00",
    "00:27:30", "00:28:00", "00:28:30",
    "00:29:00", "00:29:30", "00:30:00",
    "00:30:30", "00:31:00", "00:31:30",
    "00:32:00", "00:32:30", "00:33:00",
    "00:33:30", "00:34:00", "00:34:30",
    "00:35:00", "00:35:30", "00:36:00",
    "00:36:30", "00:37:00", "00:37:30",
    "00:38:00", "00:38:30", "00:39:00",
    "00:39:30", "00:40:00", "00:40:30",
    "00:41:00", "00:41:30", "00:42:00",
    "00:42:30", "00:43:00", "00:43:30",
    "00:44:00", "00:44:30", "00:45:00",
    "00:45:30", "00:46:00", "00:46:30",
    "00:47:00", "00:47:30", "00:48:00",
    "00:48:30", "00:49:00", "00:49:30",
    "00:50:00", "00:50:30", "00:51:00",
    "00:51:30", "00:52:00", "00:52:30",
    "00:53:00", "00:53:30", "00:54:00",
    "00:54:30", "00:55:00", "00:55:30",
    "00:56:00", "00:56:30", "00:57:00",
    "00:57:30", "00:58:00", "00:58:30",
    "00:59:00", "00:59:30", "01:00:00",
    "01:00:30", "01:01:00", "01:01:30",
    "01:02:00", "01:02:30", "01:03:00",
        ]

    }
}

class TimerGUI:
    def __init__(self, root):
        self.root = root
        self.root.title("Timer GUI")
        self.current_set = None
        self.timer_running = False
        self.remaining_time = timedelta()
        self.upcoming_events = []

        self.frame = tk.Frame(self.root)
        self.frame.pack(padx=20, pady=20)

        # Set Selection
        self.label_set = tk.Label(self.frame, text="Select Set:")
        self.label_set.grid(row=0, column=0, sticky="W")

        self.set_var = tk.StringVar()
        self.set_var.set("Select a set")
        self.set_dropdown = tk.OptionMenu(self.frame, self.set_var, *data.keys(), command=self.on_set_select)
        self.set_dropdown.grid(row=0, column=1, padx=10, pady=10, sticky="W")

        # Timer
        self.timer_label = tk.Label(self.frame, text="00:00", font=("Arial", 200), width=10)
        self.timer_label.grid(row=1, column=0, columnspan=2, padx=10, pady=10)

        # Upcoming Event
        self.event_label = tk.Label(self.frame, text="", font=("Arial", 90), fg="red")
        self.event_label.grid(row=2, column=0, columnspan=2, padx=10, pady=10)

        # Next Event Type
        self.event_type_label = tk.Label(self.frame, text="", font=("Arial", 100))
        self.event_type_label.grid(row=3, column=0, columnspan=2, padx=10, pady=10)

        # Begin Button
        self.begin_button = tk.Button(self.frame, text="Begin", command=self.start_timer, state=tk.DISABLED)
        self.begin_button.grid(row=6, column=0, columnspan=2, padx=10, pady=10)

    def on_set_select(self, selected_set):
        self.current_set = selected_set
        self.begin_button["state"] = tk.NORMAL
        first_event_type = "Tactile" if data[self.current_set]["Stim"][0] == 0 or 1 or 2 or 3 else "Water"
        self.event_type_label["text"] = f"1st Event Type: {first_event_type}"

    def start_timer(self):
        if self.current_set:
            self.timer_running = True
            self.begin_button["state"] = tk.DISABLED
            self.remaining_time = timedelta()
            self.upcoming_events = [datetime.strptime(t, "%H:%M:%S") for t in data[self.current_set]["Time"]]
            self.countup()

    def countup(self):
        if self.timer_running:
            self.remaining_time += timedelta(seconds=1)
            formatted_time = str(self.remaining_time)
            formatted_time = "0" + formatted_time if len(formatted_time) < 8 else formatted_time  # Prepend '0' if needed
            self.timer_label["text"] = formatted_time

            if self.upcoming_events:
                upcoming_event = self.upcoming_events[0]
                time_diff = upcoming_event - datetime.strptime(formatted_time, "%H:%M:%S")

                if time_diff <= timedelta(seconds=15):
                    self.event_label["text"] = f"Upcoming: {upcoming_event.strftime('%H:%M:%S')} ({time_diff.seconds}s)"
                    event_index = len(data[self.current_set]["Time"]) - len(self.upcoming_events)
                    event_type_mapping = {
                        4: "Cold water",
                        5: "Room temp",
                        6: "Hot water",
                        0: "Pinprick",
                        1: "0.07g",
                        2: "0.4g",
                        3: "2g",
                    }
                    event_type = event_type_mapping.get(data[self.current_set]["Stim"][event_index], "")
                    self.event_type_label["text"] = f"Next Event: {event_type}"
                else:
                    self.event_label["text"] = ""
                    self.event_type_label["text"] = ""

                if time_diff <= timedelta(seconds=0):
                    self.upcoming_events.pop(0)

            if self.timer_running:
                self.root.after(998, self.countup)

    def stop_timer(self):
        self.timer_running = False
    
    def pause_timer(self, event=None):
        if self.timer_running:
            self.timer_running = False
            self.begin_button["state"] = tk.NORMAL  # Enable the Begin button when paused
        else:
            self.timer_running = True
            self.begin_button["state"] = tk.DISABLED  # Disable the Begin button when running
            self.countup()

root = tk.Tk()
root.attributes("-fullscreen", True)  # Make the GUI full screen
app = TimerGUI(root)

# Function to toggle full-screen mode
def toggle_fullscreen(event=None):
    if root.attributes('-fullscreen'):
        root.attributes('-fullscreen', False)
        root.overrideredirect(False)  # Show the window decorations
    else:
        root.attributes('-fullscreen', True)
        root.overrideredirect(True)  # Hide the window decorations

# Bind both the Escape key and the spacebar to toggle full-screen mode
root.bind('<Escape>', toggle_fullscreen)
root.bind('<space>', toggle_fullscreen)
root.bind('p', app.pause_timer)  # Bind 'p' key to pause/resume the timer

root.mainloop()